<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Planner</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        .day-section {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center; /* Centers the items horizontally */
        }

        .day-container {
            border: 1px solid #ccc;
            padding: 10px;
            flex: 0 0 calc(33.333% - 20px); /* 3 per row minus the gap */
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            box-sizing: border-box; /* Ensure padding and border are included in the width */
            margin-bottom: 20px; /* Add margin to prevent overlap with the next row */
        }

        .meal-section {
            margin-top: 10px;
        }

        .food-quantity-pair {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }

        .add-more-food {
            margin-top: 10px;
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }

        .add-more-food:hover {
            background-color: #0056b3;
        }

        /* Media Query for smaller screens */
        @media (max-width: 900px) {
            .day-container {
                flex: 0 0 calc(50% - 20px); /* 2 per row */
            }
        }

        @media (max-width: 600px) {
            .day-container {
                flex: 0 0 calc(100% - 20px); /* 1 per row */
            }
        }
    </style>
</head>
<body>
    <h1>Add new Diet Plan</h1>

    <form action="/add-diet" method="POST">
        <label for="dietName">Insert Diet Plan name:</label>
        <input type="text" id="dietName" name="dietName" required>
        <br>
        <label for="dietDescription">Description:</label>
        <input type="text" id="dietDescription" name="dietDescription">
        <br>
        {% if days %}
            <h3>Select Day:</h3>
                {% for day in days %}
                    <div id = "day-container" class ="day-section">
                        <h2>{{ day.day_name }}</h2>
                        {% if meals %}
                            {% for meal in meals %}
                                <div id="meal-container-{{ day.day_type_id }}" class="meal-section">
                                    <h4>{{ meal.meal_name }}</h4>
                                    <div id="food-container-{{ day.day_type_id }}-{{ meal.meal_type_id }}">
                                        <div class="food-quantity-pair">
                                            <label for="food-{{ day.day_type_id }}-{{ meal.meal_type_id }}-0">Food:</label>
                                            <select id="food-{{ day.day_type_id }}-{{ meal.meal_type_id }}-0" name="food-{{ day.day_type_id }}-{{ meal.meal_type_id }}[]" required>
                                                <option value="" disabled selected>Select Food</option>
                                                {% for food in foods %}
                                                    <option value="{{ food.food_id }}">{{ food.name }}</option>
                                                {% endfor %}
                                            </select>
                                            <label for="quantity-{{ day.day_type_id }}-{{ meal.meal_type_id }}-0">Quantity:</label>
                                            <input type="number" id="quantity-{{ day.day_type_id }}-{{ meal.meal_type_id }}-0" name="quantity-{{ day.day_type_id }}-{{ meal.meal_type_id }}[]" placeholder="Enter quantity" required>
                                        </div>
                                    </div>
                                    <button type="button" class="add-more-food" data-day="{{ day.day_type_id }}" data-meal="{{ meal.meal_type_id }}">Add More Food</button>
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            <br>
            <button type="submit">Submit Diet Plan</button>
            {% if message %}
                {{ message }}
            {% endif %}
        {% endif %}
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Function to add more food input fields
            function addFoodInputFields(mealTypeId, dayTypeId) {
                const foodContainer = document.getElementById(`food-container-${dayTypeId}-${mealTypeId}`);
                const lastFoodQuantityPair = foodContainer.querySelector('.food-quantity-pair:last-child');
                const newFoodQuantityPair = lastFoodQuantityPair.cloneNode(true);

                // Update the IDs and names for the new inputs
                const newIndex = foodContainer.querySelectorAll('.food-quantity-pair').length;
                const foodInput = newFoodQuantityPair.querySelector('select[name^="food"]');
                const quantityInput = newFoodQuantityPair.querySelector('input[name^="quantity"]');

                foodInput.id = `food-${dayTypeId}-${mealTypeId}-${newIndex}`;
                foodInput.name = `food-${dayTypeId}-${mealTypeId}[]`;
                foodInput.value = ""; // Clear the value

                quantityInput.id = `quantity-${dayTypeId}-${mealTypeId}-${newIndex}`;
                quantityInput.name = `quantity-${dayTypeId}-${mealTypeId}[]`;
                quantityInput.value = ""; // Clear the value

                // Append the new input fields
                foodContainer.appendChild(newFoodQuantityPair);
            }

            // Add more food input fields on button click
            document.querySelectorAll('.add-more-food').forEach(function(button) {
                button.addEventListener('click', function() {
                    const mealTypeId = this.dataset.meal;
                    const dayTypeId = this.dataset.day;
                    addFoodInputFields(mealTypeId, dayTypeId);
                });
            });
        });
    </script>
</body>
</html>
